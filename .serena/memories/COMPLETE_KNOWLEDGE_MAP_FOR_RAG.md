# 🎯 KIS Estimator 완전 지식 맵 (DGX SPARK RAG 시스템용)

## 📌 프로젝트 배경
- **제작자**: CEO 직접 제작 (밤낮으로 수년간 작업)
- **목적**: AI 견적 시스템용 지식 베이스
- **투자**: NVIDIA DGX SPARK 구입 (AI 학습 전용)
- **구조**: JSON 기반 구조화 지식 (RAG 최적화)

---

## 🗂️ 핵심 파일 구조 (중복 제외 59개)

### 1️⃣ 마스터 지식 파일 (40K 토큰, 5,633줄)
**`ai_estimation_core.json`**
- 전체 카탈로그 (차단기 모델 500+개)
- 전체 외함 카탈로그 (HDS 시리즈 100+개)
- 부스바 계산 공식
- 레이아웃 엔진 파라미터
- 검증 체크리스트 (MANDATORY)
- BOM 자동 생성 규칙
- 견적서 출력 스키마
- Provenance 추적 (파일 해시)

### 2️⃣ CEO 승인 공식 (거버넌스)
**`ai_estimation_core_v1.2.0.json`**
```json
{
  "signature": "SHA256:core_v120_certified_by_ceo_20250115",
  "authority": "CEO_SIGNATURE_REQUIRED"
}
```
- PVC 커버: (W×H)/90000×12000
- 도장 면적: 2×(W×H+W×D+H×D)
- 공간 활용률: ≤0.85
- 인건비: 35,000원/시간

### 3️⃣ 국제/국내 표준
**`IEC61439_tables.json`** (IEC 61439-1:2020)
- 이격거리 (Clearance): 50V~1000V
- 연면거리 (Creepage): 오염도 2, 3
- 온도 상승 한계: 구리 105°C, 절연체 90°C
- 단락 내력: 역률 0.15, 비대칭 계수 1.8
- 보호 회로: 단면적 규정
- IP 등급: IP20~IP65

**`KS_tables.json`** (KS C 4510:2021)
- 라벨/표시: 제조사, 정격, IP등급, 단락전류
- 배선 색상: 단상(갈/청/녹황), 3상(갈/흑/회/청/녹황)
- 외함 두께: 강판 1.5mm, 알루미늄 2.0mm, SUS 1.2mm
- 설치 여유: 상200/하100/좌우150mm (벽부), 전800/후600/좌우200mm (바닥)
- 환기: 자연환기 계수 1.0/1.3, 강제환기 10회/시

---

## 🔧 차단기 지식

### 차단기 모델 파싱 규칙
**상도 (SANGDO)**:
```
S-[B|E]-[E|S]-[프레임]-[극수]
SBS-54 = 상도-배선용-표준형-50AF-4P
SEE-103 = 상도-누전-경제형-100AF-3P
SBC = 배선용-컴팩트
SEC = 누전-컴팩트
```

**LS**:
```
[A|E]-B-[N|S]-[프레임]-[극수]
ABN-54 = LS-배선용-경제형-50AF-4P
EBS-203 = LS-누전-표준형-225AF-3P
FB = 컴팩트 (예: ABS52FB)
```

### 차단용량(kA) 구분
- **소형(SIE-32)**: 2.5kA
- **경제형**: 37kA
- **표준형**: 50kA
- **대용량(600AF+)**: 50kA

### 차단기 선택 기준
1. 기본: **경제형** 우선 (Economy First)
2. 경제형 없으면 → **표준형** 폴백
3. 누전 2P 20/30A → **소형** (SIE-32, 32GRHS)
4. 배선용 2P 20/30A → **소형** (SIB-32, BS32)
5. 2P 20/30A를 50AF 요구 → **컴팩트/FB**
6. 4P 50AF (20~50A) → 경제형 없음, **표준형 사용**
7. SPD용 → **MCCB 4P 40A** (30A/50A 변동 가능)

### 차단기 치수 (W×H×D mm)
```json
소형차단기: 33×70×42
FB 2P: 50×96×60
50AF 2P: 50×130×60
100AF 경제형 2P: 50×130×60
100AF 표준형 2P: 60×155×60 (경제형 +10W, +25H)
200~250AF 3P: 105×165×60
400AF 4P: 187×257×109
600AF 4P: 280×280×109
800AF 4P: 280×280×109
```

### 차단기 마주보기 규칙
- **소형 2P 15~30A**: 마주보기 40mm
- **양 어레이** (400AF 이상):
  - 최소 간격: 25mm
  - 측면 여유: 50mm
  - 중심 간격: 150mm
  - 유지보수 여유: 75mm

---

## 📦 외함 지식

### 외함 크기 계산 (부속자재 포함)
**H 공식**:
```
H = A + B + C + D + E

A (상단 공간):
  A1 (메인 프레임별):
    - 20~60A: 130mm
    - 75~100A: 170mm
  A2 (고정): 130mm

B (메인-분기 간격): 30mm

C (분기 총높이):
  2P: 30AF=40mm, 50AF=50mm, 100AF=50mm, 200~250AF=105mm, 400AF=140mm, 600~800AF=210mm
  3P: 50AF=75mm, 100AF=75mm, 125AF=90mm, 200~250AF=105mm, 400AF=140mm, 600~800AF=210mm
  4P: 50AF=100mm, 60AF=100mm, 100AF=100mm, 125AF=120mm, 200~250AF=140mm, 400AF=185mm, 600~800AF=280mm

D (하단 공간):
  - 20~225A: 150mm
  - 300~400A: 200mm
  - 500A: 250mm

E (부속자재 여유): 20~30% 권장, PVC duct 40mm
```

**부속자재 포함 상세 공식**:
```
H_total = P + 2D + S_top + S_bottom + M

P: 분전반 본체 높이(mm)
D: PVC 덕트 40mm
S_top: 상단 여유 50mm
S_bottom: 하단 여유 50mm
M: 부속자재 높이 합(mm)

2단 배치 시: H_total += (2×D + 2×50 + M)
```

**W 공식** (AF별):
```json
{
  "100AF": 600mm,
  "125~250AF": 700mm,
  "400AF": 800mm,
  "600AF+": 900mm
}

특수 조건:
- 소형만: 500mm
- 분기 ≥28개: +100mm
- 200~250AF 분기 ≥2개: +100mm
- PVC duct: 유효W -100mm (좌우 각 30mm 여유)
```

**D 공식**:
```json
{
  "기본": 200mm,
  "PBL 있으면": 250mm,
  "SPD 있으면": +100mm
}
```

### 기성함 vs 주문제작함
**기성함 (HB - 수백 개 카탈로그)**:
- 내판 간격: 50mm
- 재질: STEEL 1.6T
- 표준 사이즈: HDS 60 60 15 ~ HDS 120 160 30
- 가격: 80,000원 ~ 170,000원대

**주문제작함**:
- 내판 간격: 100mm
- 비표준 사이즈
- 특수 요구 (IP65, SUS, 대형)

### 계량기 취부 규칙
**옆 취부**:
- W 증가 (meter W만큼)
- H 변화 없음

**하부 취부**:
- W: 변화 없거나 +0~100mm
- H: 증가 (meter 수×200mm)
- 2개 이상: H +250mm 추가

---

## 🧲 부속자재 지식

### 마그네트 (Magnet Contactor)
**사이즈 테이블**:
```
MC9~MC22:  W=46mm,  H=75mm
MC32~MC40: W=69mm,  H=83mm
MC50~MC65: W=79mm,  H=106mm
MC75~MC100: W=94mm, H=140mm
```

**BOM 자동 생성** (BND_MAGNET_BASE):
마그네트 1개당 **필수** 추가:
```json
{
  "FUSE_HOLDER": "1EA (4A, 4,000원)",
  "TERMINAL_BLOCK_600V": "3EA (600V, 4,000원)", // ⚠️ 3개!
  "DUCT_PVC_40": "2EA (3,300원)",
  "CABLE_WIRE": "2EA (KIV, 25,000원)", // ⚠️ 2EA!
  "인건비": "+20,000원"
}
```

### 타이머 (Timer)
**24H 타이머**: W=65mm, H=100mm
**일몰일출 타이머**: W=65mm, H=102mm, 주로 20A

**BOM 자동 생성** (BND_TIMER_EFFECT):
타이머 있으면 **필수** 추가:
```json
{
  "PBL": "1EA (ON/OFF 또는 ON/OFF/SS)",
  "기본": "2EA",
  "SS 포함": "3EA",
  "단가": "4,000원"
}
```

### 계량기 (Meter)
**3상**: 130×130mm
**단상**: 130×80mm
**CT계량기**: 130×130mm (>120A 시)

**BOM 자동**: CABLE/WIRE 1식 (15,000원)

### SPD
**BOM 자동**: CABLE/WIRE 1식 (15,000원)

### V/A-METER
- 도어 타공
- 캠스위치(RSTN) 포함
- 메인 우측 빈공간 배치

---

## ⚡ 부스바 (Busbar) 지식

### 주 부스바 (Main Busbar)
**무게 계산 공식**:
```
질량(kg) = (W×H) × 계수
단가: 20,000원/kg

계수 (메인 AF별):
- 20~250A: 0.000007
- 300~400A: 0.000013
- 500~800A: 0.000015
```

### 분기 부스바 (Branch Busbar)
**규격 (두께T×폭)**:
```
~100A:      3T×15
125~250A:   5T×20
300~400A:   6T×30
500~800A:   8T×40
```

**공식**: T × width × length (KG)
**단가**: 19,500원/KG

---

## 💰 비용 지식

### P-커버 (PVC Cover)
**아크릴 (기본)**: 무료 또는 저가
**철재 (요청 시)**:
```
공식: ((W×H)/90000)×12000원
반올림: 100원 단위
```

### 도장 (Coating)
```
50~250AF: 5,000원
400~800AF: 10,000원
```

### 조립 인건비 (Assembly Labor)
```json
{
  "50~100AF": {
    "기준": "600×700",
    "기본": "50,000원",
    "H 100mm당": "+15,000원",
    "소형 단상 20A 다수": "+10,000원"
  },
  "125~250AF": {
    "기준": "700×800",
    "기본": "60,000원",
    "H 100mm당": "+15,000원",
    "소형 단상 20A 다수": "+10,000원"
  },
  "400AF": {
    "기준": "800×1200",
    "기본": "130,000원",
    "H 100mm당": "+20,000원",
    "소형 예외": "+15,000원"
  },
  "600~800AF": {
    "기준": "900×1600",
    "기본": "250,000원",
    "H 100mm당": "+40,000원",
    "소형 예외": "+15,000원"
  }
}
```

### 잡자재 (Consumables)
```json
{
  "기준": "600×700",
  "기본": "7,000원",
  "H 100mm당": "+1,000원",
  "부속자재 1개당": "+12,000원",
  "상한": "42,000원"
}
```

### 지지/부자재 (Supports)
**ET (Earth Terminal)**:
```
50~250AF: 4,500원 (분기 12개마다 +1)
400AF: 12,000원 (분기 12개마다 +1)
600~800AF: 18,000원 (분기 12개마다 +1)
```

**NT**: 3,000원 × 1EA
**NP-CARD-HOLDER**: 분기 총수량
**NP-3T-40-200**: 4,000원 × 1EA

**INSULATOR (절연애자)**:
```
메인당 4개
50~250AF: 1,100원/개
400~800AF: 4,400원/개
```

**ELB-SUPPORT (소형차단기 지지대)**:
```
대상 모델: SIE-32, SIB-32, 32GRHS, BS32
단가: 500원/개
수량: 해당 모델 총수량
```

### 베이스 (Base)
**적용 대상**: 옥내자립, 옥외자립, FRP함
**크기**: W=외함W, H=200mm(기본), D=외함D
**단가 공식**: ((W×H)/90000)×32,000원

### 전주부착형 (Pole Mount)
**조건**: 반드시 옥외함
**추가 비용**: 브래킷 용접 +20,000원

---

## 📐 레이아웃 지식

### Virtual Layout Engine 파라미터
```json
{
  "side_margin_l_mm": 40,
  "side_margin_r_mm": 40,
  "top_margin_mm": 60,
  "bottom_margin_mm": 80,
  "duct_w_left_mm": 60,
  "duct_w_right_mm": 60,
  "row_gap_mm": 20,
  "item_gap_x_mm": 12,
  "item_gap_y_mm": 10,
  "busbar_corridor_mm": 80,
  "panel_depth_mm": 600,
  "meter_cell_w_mm": 130,
  "meter_cell_h_mm": 200
}
```

### 배치 규칙
**메인차단기**: 중앙 상단 고정
**분기 배치**: 좌우 대칭 3열 또는 4열
**정렬 순서**: 극수 > 프레임 > 암페어 순

---

## ✅ 검증 체크리스트 (MANDATORY)

RAG 시스템이 반드시 검증해야 할 항목:

1. **CHK_BUNDLE_MAGNET**: 마그네트 → 동반자재 3EA/2EA 포함
2. **CHK_PBL_ON_OFF**: 도면 ON/OFF → PBL 포함
3. **CHK_TIMER_SS**: 타이머 → SS/PBL 처리
4. **CHK_PVC_DUCT_EFFECT**: PVC덕트 → 유효W-100, 좌우30
5. **CHK_ENCLOSURE_H_FORMULA**: H_total 공식 + 2단 보정
6. **CHK_BUSBAR_RANGE**: 부스바 용량 구간/규격 매칭
7. **CHK_ASSEMBLY_MISC_RULES**: 조립비/잡자재/코팅/피커버

---

## 🔍 도면 심볼 매핑

```json
{
  "T": "TIMER_24H",
  "ON_OFF": "PBL_ONOFF",
  "연결선 추적": "timer → magnet 연결 수량 파악"
}
```

---

## 📋 견적서 출력 스키마

**섹션 순서**:
1. ENCLOSURE (외함)
2. MAIN_BREAKER (메인차단기)
3. BRANCH_BREAKERS (분기차단기) - poles↓, amp↓ 정렬
4. ACCESSORIES_REQUIRED (부속자재 필수)
5. ACCESSORIES_OPTIONAL (부속자재 선택)
6. BUSBAR (부스바)
7. SUPPORTS (지지/부자재)
8. COSTS (잡자재/인건비)
9. TOTALS (합계)

**각 항목**: model, AF, poles, qty, notes, price

---

## 🎯 RAG 시스템 활용 가이드

### DGX SPARK 통합 시 주의사항

1. **JSON 구조 보존**: 계층 구조 그대로 임베딩
2. **단위 명시**: mm, KG, KRW, kA 등 단위 유지
3. **공식 보존**: 수식을 텍스트로 변환하지 말 것
4. **Provenance 추적**: 파일 해시로 버전 관리
5. **검증 규칙**: MANDATORY 체크리스트 우선순위 최상
6. **시맨틱 청크**: 섹션별로 임베딩 (차단기/외함/부속자재 분리)

### 권장 청킹 전략
```
Chunk 1: 차단기 모델 파싱 + 선택 기준
Chunk 2: 차단기 치수 + 차단용량
Chunk 3: 외함 크기 계산 공식 (H/W/D)
Chunk 4: 부속자재 BOM 자동 생성
Chunk 5: 부스바 계산
Chunk 6: 비용 계산 (P-커버, 도장, 조립비)
Chunk 7: 레이아웃 엔진 파라미터
Chunk 8: IEC/KS 표준
Chunk 9: 검증 체크리스트
```

### 임베딩 모델 권장사항
- **다국어**: KO + EN 혼합 (모델명 영문, 설명 한글)
- **기술 용어**: 전기 공학 특화 임베딩 필요
- **수식 처리**: LaTeX 또는 구조화 표현 유지

---

## 📊 통계

- **총 파일**: 12,980개 → **핵심**: 59개 (99% 중복 제거)
- **마스터 파일**: 5,633줄 (40K 토큰)
- **차단기 모델**: 500+ 개
- **기성함 카탈로그**: 100+ 개
- **자동 BOM 규칙**: 2개 (마그네트, 타이머)
- **검증 규칙**: 7개 (MANDATORY)
- **국제 표준**: IEC 61439-1:2020
- **국내 표준**: KS C 4510:2021

---

## 🚀 다음 단계

1. **kis-estimator-main 통합**: 59개 핵심 파일
2. **RAG 인덱싱**: DGX SPARK에 임베딩
3. **회귀 테스트**: 20/20 PASS 검증
4. **API 통합**: FastAPI + FIX-4 Pipeline
5. **프로덕션 배포**: Supabase + Redis + Celery

---

*이 문서는 수년간의 실무 노하우가 집약된 지식 자산입니다.*
*DGX SPARK RAG 시스템 구축에 최적화되어 있습니다.*
